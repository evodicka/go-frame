<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go-Frame</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <!-- Load Vue.js from local file -->
    <script src="vue.global.js"></script>
    <style>
        /* Styles ported from web/src/styles.css */
        body {
            margin: 0;
            background-color: black;
        }

        /* Styles derived from web/src/app/image-display/image/image.component.css */
        #app {
            /* .app-image-wrapper equivalent */
            height: 100%;
            width: 100%;
            position: absolute;
        }

        img {
            max-width: 100%;
            max-height: 100%;
            margin: auto;
            display: block;
        }
    </style>
</head>

<body>
    <div id="app">
        <img v-if="image" :src="imageSrc" alt="Slideshow Image">
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    image: null,
                    timer: null
                }
            },
            computed: {
                imageSrc() {
                    if (!this.image || !this.image.path) {
                        return '';
                    }
                    return '/static/images/' + this.image.path;
                }
            },
            methods: {
                fetchImage() {
                    fetch('/api/image/current')
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            this.image = data;
                        })
                        .catch(error => {
                            console.error('Error fetching image:', error);
                        });
                }
            },
            mounted() {
                // Initial fetch
                this.fetchImage();

                // Poll every 30 seconds
                this.timer = setInterval(this.fetchImage, 30000);
            },
            unmounted() {
                if (this.timer) {
                    clearInterval(this.timer);
                }
            }
        }).mount('#app')
    </script>
</body>

</html>